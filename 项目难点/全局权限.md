# 全局权限组件


设计一个判断权限的通用型组件

难点： 外层不能包裹div等元素标签， 但是无权限且点击类型时要禁用子元素的操作。

要使用react提供的cloneElement方法

核心代码：

~~~js
/**
 * 权限组件
 *  接受一个组件和一个authName以及type(处理类型,点击类，显隐类)，
 *  通过useAuth判断是否存在该权限，存在权限的话不做任何处理，
 *  不存在权限的话先屏蔽子组件的鼠标事件point-event，
 *  然后再根据传入的type进行相关处理，是对子组件进行显隐，
 *  还是在点击的时候弹出提示“没有权限”。
 */

import * as React from 'react';
import type { HTMLAttributes } from 'react';
import { message } from 'antd';
import classnames from 'classnames';
import useAuth from 'src/hooks/useAuth';
import { AuthUidType } from 'src/assets/js/authDictionary';
import styles from './index.module.less';

interface AuthType {
  authUid: AuthUidType | ''; // 判断权限的模块名
  type: 'click' | 'display'; // 处理类型：点击类 | 显隐类
  className?: string;
  children: React.ReactElement;
}

const AuthComponent = (props: AuthType) => {
  const { authUid, type, children, className } = props;
  /** 是否有权限 */
  const hasAuth = useAuth(authUid);

  const child = React.Children.only(children) as React.ReactElement;
  const newChildProps: HTMLAttributes<HTMLElement> & { key: string } = {
    key: 'trigger',
  };

  const childrenClassName = classnames(
    child && child.props && child.props.className,
    className,
    {
      [styles.forbidClick]: !hasAuth && type === 'click',
    },
    {
      [styles.displayNone]: !hasAuth && type === 'display',
    }
  );

  if (childrenClassName) {
    newChildProps.className = childrenClassName;
  }

  /** 如果为点击处理类型, 并且无权限, 增加点击事件 */
  if (!hasAuth && type === 'click') {
    newChildProps.onClick = () => {
      message.warning({
        content: '您暂无相关操作权限，请联系管理员开通',
        key: 'clickNoAuth',
      });
    };
  }

  const TriggerChildren = React.cloneElement(child, { ...newChildProps });

  return TriggerChildren;
};

export default AuthComponent;

~~~

